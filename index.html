<!DOCTYPE html>
<html>
<head>
  <title>Sync Player</title>
  <style>
    body {
      margin: 0;
      background: black;
      overflow: hidden;
      font-family: sans-serif;
    }
    #container {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    video, audio {
      position: absolute;
      max-width: 100%;
      max-height: 100%;
    }
    .hidden {
      display: none;
    }
    #status {
      position: absolute;
      bottom: 5px;
      left: 5px;
      color: white;
      font-size: 12px;
      background: rgba(0,0,0,0.5);
      padding: 2px 6px;
      border-radius: 3px;
      display: none; /* disembunyikan */
    }
  </style>
</head>
<body>
  <div id="container">
    <video id="vid1" src="https://files.catbox.moe/21926t.mp4" preload="auto" class="hidden"></video>
    <audio id="aud1" src="https://files.catbox.moe/t5zj2x.mp3" preload="auto"></audio>
    <div id="status">Status: idle</div>
  </div>

  <script>
    const video = document.getElementById('vid1');
    const audio = document.getElementById('aud1');
    const status = document.getElementById('status');
    const container = document.getElementById('container');

    let syncOffset = 0.1; // delay kecil sinkronisasi
    let lastSeekTime = 0;

    const showVideoAt = 10; // detik kapan video muncul
    const hideVideoAt = 90; // detik kapan video disembunyikan
    let preparing = false;

    function show(el) { el.classList.remove('hidden'); }
    function hide(el) { el.classList.add('hidden'); }

    function prepareVideo() {
      if (preparing) return;
      preparing = true;
      video.pause();
      video.currentTime = 0;
      video.play().then(() => {
        video.pause();
        preparing = false;
      }).catch(() => {
        preparing = false;
      });
    }

    // Sinkronisasi audio dan video
    function syncVideo() {
      const currentTime = audio.currentTime;
      if (currentTime >= showVideoAt && currentTime <= hideVideoAt) {
        show(video);
        const target = currentTime - showVideoAt;
        const diff = Math.abs(video.currentTime - target);
        if (diff > 0.2) {
          video.currentTime = target;
        }
        if (audio.paused && !video.paused) video.pause();
        else if (!audio.paused && video.paused) video.play();
      } else {
        hide(video);
        video.pause();
      }
    }

    // Sync loop
    setInterval(syncVideo, 100);

    // Handle play
    audio.addEventListener('play', () => {
      prepareVideo();
      setTimeout(() => {
        if (audio.currentTime >= showVideoAt && audio.currentTime <= hideVideoAt) {
          video.play();
        }
      }, syncOffset * 1000);
    });

    // Handle pause
    audio.addEventListener('pause', () => {
      video.pause();
    });

    // Handle seek
    audio.addEventListener('seeking', () => {
      lastSeekTime = Date.now();
    });
    audio.addEventListener('seeked', () => {
      setTimeout(() => {
        if (Date.now() - lastSeekTime >= 50) {
          if (audio.currentTime >= showVideoAt && audio.currentTime <= hideVideoAt) {
            video.currentTime = audio.currentTime - showVideoAt;
            video.pause();
            video.play();
          }
        }
      }, 80);
    });

    // Sembunyikan video saat habis
    video.addEventListener('ended', () => {
      hide(video);
    });

    // Sembunyikan status
    status.style.display = 'none';
  </script>
</body>
</html>
