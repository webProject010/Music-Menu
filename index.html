<!DOCTYPE html>
<html>
<head>
  <title>Music Player</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    .video-container {
      position: relative;
      max-width: 100%;
      overflow: hidden;
      display: none;
      margin-bottom: 10px;
    }
    video {
      width: 100%;
      height: auto;
      display: block;
    }
    .warning {
      color: red;
      font-size: 12px;
      display: none;
    }
  </style>
</head>
<body>

<h2>Music Player</h2>

<div class="video-container" id="videoContainer">
  <video id="video" preload="auto">
    <source src="https://webproject010.github.io/Music-Media/JOJO-T3.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>
  <div class="warning" id="warningText">Maaf, perangkat anda belum siap melakukan tindakan cepat ini.</div>
</div>

<audio id="audio1" controls>
  <source src="https://files.catbox.moe/dz2qsc.mp3" type="audio/mpeg">
</audio>

<audio id="audio2" controls>
  <source src="https://files.catbox.moe/0ixp2e.mp3" type="audio/mpeg">
</audio>

<audio id="audio3" controls>
  <source src="https://files.catbox.moe/6jj0o1.mp3" type="audio/mpeg">
</audio>

<script>
  const video = document.getElementById('video');
  const videoContainer = document.getElementById('videoContainer');
  const warningText = document.getElementById('warningText');
  const audios = document.querySelectorAll('audio');

  const videoTriggers = [
    { audio: audios[0], start: 1.0, end: 5.0 },
    { audio: audios[1], start: 1.0, end: 6.0 },
    { audio: audios[2], start: 2.0, end: 7.0 },
  ];

  let activeAudio = null;
  let trigger = null;
  let syncInterval = null;

  function hideVideo() {
    video.pause();
    videoContainer.style.display = 'none';
    warningText.style.display = 'none';
  }

  function showVideo() {
    videoContainer.style.display = 'block';
  }

  function resetAll() {
    audios.forEach(a => {
      if (a !== activeAudio) {
        a.pause();
        a.currentTime = 0;
      }
    });
    hideVideo();
    clearInterval(syncInterval);
  }

  function setupSync(audio) {
    activeAudio = audio;
    trigger = videoTriggers.find(t => t.audio === audio);

    if (!trigger) return;

    clearInterval(syncInterval);

    syncInterval = setInterval(() => {
      const aTime = activeAudio.currentTime;

      // Jika tidak di dalam range trigger, sembunyikan video
      if (aTime < trigger.start || aTime > trigger.end) {
        hideVideo();
        return;
      }

      // Tampilkan video jika waktu sesuai
      showVideo();

      const targetVideoTime = aTime - trigger.start;

      // Cek apakah video tidak sinkron >0.3 detik
      if (Math.abs(video.currentTime - targetVideoTime) > 0.3) {
        try {
          video.currentTime = targetVideoTime;
        } catch (e) {
          warningText.style.display = 'block';
        }
      }

      // Play video jika belum main
      if (video.paused) {
        try {
          video.play();
        } catch (e) {
          warningText.style.display = 'block';
        }
      }

      // Auto-hide jika video selesai
      if (video.ended || aTime > trigger.end) {
        hideVideo();
      }
    }, 150);
  }

  audios.forEach(audio => {
    audio.addEventListener('play', () => {
      resetAll();
      setupSync(audio);
    });

    audio.addEventListener('pause', () => {
      if (trigger && audio === activeAudio) {
        video.pause();
      }
    });

    audio.addEventListener('seeking', () => {
      if (trigger && audio === activeAudio) {
        const pos = audio.currentTime;
        if (pos >= trigger.start && pos <= trigger.end) {
          try {
            video.currentTime = pos - trigger.start;
            if (video.paused) video.play();
            showVideo();
          } catch (e) {
            warningText.style.display = 'block';
          }
        } else {
          hideVideo();
        }
      }
    });
  });

  video.addEventListener('ended', hideVideo);
</script>

</body>
</html>
